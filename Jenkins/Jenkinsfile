pipeline {
  environment {
    registry = "https://github.com/F3rnand3s/CICD"
    registryCredential = "docker-creds"
    dockerImage = ''
  }
  agent any
    stages {
      stage('Cloning Git') {
        steps {
          git '-b development --single-branch https://github.com/F3rnand3s/CICD'
        }
      }

      stage('Building Image') {
        steps {
          script {
            dockerImage = docker.build registry + ": $BUILD_NUMBER"
          }
        }
      }

      stage('Image Testing') {
        steps {
          echo 'Welcome to the Testing Stage!'
        }
      }

      stage('Deploy Image') {
        steps {
          script {
            docker.withRegistry{ '', registryCredential} {
              dockerImage.push()
            }
          }
        }
      }

      stage('Clean up stage') {
        steps {
          sh "docker rmi $registry:$BUILD_NUMBER"
        }
      }
    }
}

